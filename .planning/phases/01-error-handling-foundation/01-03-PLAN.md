---
phase: 01-error-handling-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/parser/operuh.jl
autonomous: true

must_haves:
  truths:
    - "OPERUH parser throws ParserError when REST record parsing fails"
    - "OPERUH parser throws ParserError when ELEM record parsing fails"
    - "OPERUH parser throws ParserError when LIM record parsing fails"
    - "OPERUH parser throws ParserError when VAR record parsing fails"
    - "No @warn + return nothing patterns remain in operuh.jl"
  artifacts:
    - path: "src/parser/operuh.jl"
      provides: "Hydro operation parser with explicit error handling"
      contains: "throw(ParserError"
  key_links:
    - from: "operuh.jl catch blocks"
      to: "ParserError"
      via: "throw(ParserError(msg, filename, line_num, line))"
      pattern: "catch.*throw\\(ParserError"
---

<objective>
Replace all @warn + return nothing silent failure patterns in operuh.jl with explicit throw(ParserError(...)).

Purpose: ERR-04 - Eliminate silent failures where parser logs warning and returns nothing, leaving caller unaware of failure.
Output: operuh.jl that throws ParserError for all parsing failures.

**Problem:** 4 catch blocks log warnings and return nothing, causing callers to receive nothing without knowing parsing failed.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-error-handling-foundation/01-RESEARCH.md

# Reference Implementations
# - idessem: https://github.com/renan-iod/idessem (DESSEM parsing reference)
# - inewave: https://github.com/renan-iod/inewave (NEWAVE parsing reference, related ecosystem)
#
# These provide patterns for error handling and parser structure.
# Check idessem's OPERUH parsing patterns for reference.

# Current anti-pattern (from RESEARCH.md):
# catch e
#     @warn "Failed to parse OPERUH REST record" line exception = e
#     return nothing
# end
#
# Should become:
# catch e
#     if isa(e, ParserError)
#         rethrow(e)
#     else
#         throw(ParserError("Failed to parse OPERUH REST record: $(sprint(showerror, e))", filename, line_num, line))
#     end
# end
</context>

<tasks>

<task type="auto">
  <name>Replace silent failures in operuh.jl</name>
  <files>src/parser/operuh.jl</files>
  <action>
Replace all 4 @warn + return nothing patterns (lines 114, 151, 191, 235) with explicit ParserError throws.

**Pattern to replace:**
```julia
# BEFORE (lines 113-116, 150-153, 190-193, 234-237):
catch e
    @warn "Failed to parse OPERUH REST record" line exception = e
    return nothing
end
```

**Replacement pattern:**
```julia
# AFTER:
catch e
    if isa(e, ParserError)
        rethrow(e)
    else
        throw(ParserError("Failed to parse OPERUH REST record: $(sprint(showerror, e))", filename, line_num, line))
    end
end
```

**For each record type:**
- Line 114: REST record → "Failed to parse OPERUH REST record"
- Line 151: ELEM record → "Failed to parse OPERUH ELEM record"  
- Line 191: LIM record → "Failed to parse OPERUH LIM record"
- Line 147: VAR record → "Failed to parse OPERUH VAR record"

CRITICAL:
- ParserError argument order: (msg, file, line, content)
- Preserve filename and line_num variable names as used in current code
- Include original exception message using `sprint(showerror, e)`
  </action>
  <verify>
grep -c "@warn" src/parser/operuh.jl returns 0
grep -c "return nothing" src/parser/operuh.jl | verify none are after @warn
  </verify>
  <done>All @warn + return nothing patterns in operuh.jl replaced with throw(ParserError(...))</done>
</task>

</tasks>

<verification>
1. Run `grep -n "@warn" src/parser/operuh.jl` - should return empty
2. Run `grep -n "return nothing" src/parser/operuh.jl` - verify none are in catch blocks
3. Run `julia --project -e 'using Pkg; Pkg.test()'` - all tests should pass
4. Verify that invalid OPERUH data now throws ParserError instead of returning nothing
</verification>

<success_criteria>
- Zero @warn patterns in operuh.jl
- All parsing failures throw ParserError
- Existing tests pass
- Invalid OPERUH data causes ParserError (not silent nothing return)
</success_criteria>

<output>
After completion, create `.planning/phases/01-error-handling-foundation/01-03-SUMMARY.md`
</output>
